# Migration `20200712161420`

This migration has been generated by Alexander Swed at 7/12/2020, 4:14:20 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "Teacher" (
"userId" INTEGER NOT NULL,
    PRIMARY KEY ("userId"),FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "TechingClass" (
"classId" INTEGER NOT NULL,
"color" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"scheduleId" INTEGER NOT NULL,
"teacherId" INTEGER NOT NULL,FOREIGN KEY ("classId") REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("teacherId") REFERENCES "Teacher"("userId") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("scheduleId") REFERENCES "TechingClassSchedule"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Class" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"title" TEXT NOT NULL)

CREATE TABLE "TechingClassSchedule" (
"durationMinutes" INTEGER NOT NULL,
"endDate" DATE ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"repeatsEvery" INTEGER ,
"repetition" TEXT NOT NULL DEFAULT 'week',
"startDate" DATE ,
"startTime" TEXT NOT NULL)

CREATE TABLE "Lesson" (
"classId" INTEGER NOT NULL,
"date" DATE NOT NULL,
"descrition" TEXT ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"title" TEXT NOT NULL,FOREIGN KEY ("classId") REFERENCES "TechingClass"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "StudyPlan" (
"classId" INTEGER NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,FOREIGN KEY ("classId") REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Topic" (
"description" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"lessonId" INTEGER ,
"studyPlanId" INTEGER ,
"title" TEXT NOT NULL,FOREIGN KEY ("studyPlanId") REFERENCES "StudyPlan"("id") ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY ("lessonId") REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE)

CREATE TABLE "new_User" (
"avatarUrl" TEXT ,
"disabled" BOOLEAN  DEFAULT false,
"email" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"issuer" TEXT NOT NULL,
"lastActivityAt" DATE ,
"lastLoginAt" DATE ,
"name" TEXT ,
"phoneNumber" TEXT ,
"registeredAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP,
"timeZone" TEXT )

INSERT INTO "new_User" ("avatarUrl", "disabled", "email", "id", "issuer", "lastActivityAt", "lastLoginAt", "name", "phoneNumber", "registeredAt", "timeZone") SELECT "avatarUrl", "disabled", "email", "id", "issuer", "lastActivityAt", "lastLoginAt", "name", "phoneNumber", "registeredAt", "timeZone" FROM "User"

PRAGMA foreign_keys=off;
DROP TABLE "User";;
PRAGMA foreign_keys=on

ALTER TABLE "new_User" RENAME TO "User";

CREATE UNIQUE INDEX "User.issuer" ON "User"("issuer")

CREATE UNIQUE INDEX "User.email" ON "User"("email")

CREATE UNIQUE INDEX "Teacher_userId" ON "Teacher"("userId")

CREATE UNIQUE INDEX "TechingClass_scheduleId" ON "TechingClass"("scheduleId")

CREATE UNIQUE INDEX "Class.title" ON "Class"("title")

CREATE UNIQUE INDEX "StudyPlan_classId" ON "StudyPlan"("classId")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200711202532-init..20200712161420
--- datamodel.dml
+++ datamodel.dml
@@ -1,24 +1,86 @@
 datasource db {
     provider = "sqlite"
-    url = "***"
+    url = "***"
 }
 generator client {
     provider = "prisma-client-js"
 }
-// internal info
 model User {
-    id             Int       @default(autoincrement()) @id
+    id             Int       @id @default(autoincrement())
     issuer         String    @unique
     email          String    @unique
     name           String?
-    alias          String?
     phoneNumber    String?
     avatarUrl      String?
     timeZone       String?
     disabled       Boolean?  @default(false)
     registeredAt   DateTime  @default(now()) // ISO Date
     lastLoginAt    DateTime? // ISO Date
     lastActivityAt DateTime? // ISO Date
+    teacher        Teacher?
 }
+
+model Teacher {
+    userId  Int            @id
+    user    User           @relation(fields: [userId], references: [id])
+    classes TechingClass[]
+}
+
+model TechingClass {
+    id         Int                  @id @default(autoincrement())
+    class      Class                @relation(fields: [classId], references: [id])
+    classId    Int
+    teacher    Teacher              @relation(fields: [teacherId], references: [userId])
+    teacherId  Int
+    schedule   TechingClassSchedule @relation(fields: [scheduleId], references: [id])
+    scheduleId Int
+    color      String
+    lessons    Lesson[]
+}
+
+model Class {
+    id             Int            @id @default(autoincrement())
+    title          String         @unique
+    techingClasses TechingClass[]
+    plan           StudyPlan
+}
+
+model TechingClassSchedule {
+    id              Int          @id @default(autoincrement())
+    class           TechingClass
+    startDate       DateTime?
+    endDate         DateTime?
+    repeatsEvery    Int?
+    repetition      String       @default("week")
+    startTime       String
+    durationMinutes Int
+}
+
+model Lesson {
+    id         Int          @id @default(autoincrement())
+    class      TechingClass @relation(fields: [classId], references: [id])
+    classId    Int
+    title      String
+    date       DateTime
+    descrition String?
+    topics     Topic[]
+}
+
+model StudyPlan {
+    id      Int     @id @default(autoincrement())
+    class   Class   @relation(fields: [classId], references: [id])
+    classId Int
+    topics  Topic[]
+}
+
+model Topic {
+    id          Int        @id @default(autoincrement())
+    title       String
+    description String
+    studyPlan   StudyPlan? @relation(fields: [studyPlanId], references: [id])
+    studyPlanId Int?
+    lesson      Lesson?    @relation(fields: [lessonId], references: [id])
+    lessonId    Int?
+}
```


