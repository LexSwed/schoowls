# Migration `20200718193846`

This migration has been generated by Alexander Swed at 7/18/2020, 7:38:46 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "User" (
"avatarUrl" TEXT ,
"disabled" BOOLEAN  DEFAULT false,
"email" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"lastActivityAt" DATE ,
"lastLoginAt" DATE ,
"name" TEXT NOT NULL,
"phoneNumber" TEXT ,
"registeredAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP,
"timeZone" TEXT )

CREATE TABLE "Teacher" (
"userId" INTEGER NOT NULL,
    PRIMARY KEY ("userId"),FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "TechingClass" (
"classId" INTEGER NOT NULL,
"color" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"scheduleId" INTEGER NOT NULL,
"teacherId" INTEGER NOT NULL,FOREIGN KEY ("classId") REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("teacherId") REFERENCES "Teacher"("userId") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("scheduleId") REFERENCES "TechingClassSchedule"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Class" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"name" TEXT NOT NULL)

CREATE TABLE "TechingClassSchedule" (
"durationMinutes" INTEGER NOT NULL,
"endDate" DATE ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"repeatsEvery" INTEGER ,
"repetition" TEXT NOT NULL DEFAULT 'week',
"startDate" DATE ,
"startTime" TEXT NOT NULL)

CREATE TABLE "Lesson" (
"classId" INTEGER NOT NULL,
"date" DATE NOT NULL,
"descrition" TEXT ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"title" TEXT NOT NULL,FOREIGN KEY ("classId") REFERENCES "TechingClass"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "StudyPlan" (
"classId" INTEGER NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,FOREIGN KEY ("classId") REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Topic" (
"description" TEXT NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"lessonId" INTEGER ,
"studyPlanId" INTEGER ,
"title" TEXT NOT NULL,FOREIGN KEY ("studyPlanId") REFERENCES "StudyPlan"("id") ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY ("lessonId") REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE)

CREATE UNIQUE INDEX "User.email" ON "User"("email")

CREATE UNIQUE INDEX "Teacher_userId" ON "Teacher"("userId")

CREATE UNIQUE INDEX "TechingClass_scheduleId" ON "TechingClass"("scheduleId")

CREATE UNIQUE INDEX "Class.name" ON "Class"("name")

CREATE UNIQUE INDEX "StudyPlan_classId" ON "StudyPlan"("classId")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200718193846
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,85 @@
+datasource db {
+    provider = "sqlite"
+    url = "***"
+}
+
+generator client {
+    provider = "prisma-client-js"
+}
+
+model User {
+    id             Int       @id @default(autoincrement())
+    email          String    @unique
+    name           String
+    phoneNumber    String?
+    avatarUrl      String?
+    timeZone       String?
+    disabled       Boolean?  @default(false)
+    registeredAt   DateTime  @default(now()) // ISO Date
+    lastLoginAt    DateTime? // ISO Date
+    lastActivityAt DateTime? // ISO Date
+    teacher        Teacher?
+}
+
+model Teacher {
+    userId  Int            @id
+    user    User           @relation(fields: [userId], references: [id])
+    classes TechingClass[]
+}
+
+model TechingClass {
+    id         Int                  @id @default(autoincrement())
+    class      Class                @relation(fields: [classId], references: [id])
+    classId    Int
+    teacher    Teacher              @relation(fields: [teacherId], references: [userId])
+    teacherId  Int
+    schedule   TechingClassSchedule @relation(fields: [scheduleId], references: [id])
+    scheduleId Int
+    color      String
+    lessons    Lesson[]
+}
+
+model Class {
+    id             Int            @id @default(autoincrement())
+    name           String         @unique
+    techingClasses TechingClass[]
+    plan           StudyPlan
+}
+
+model TechingClassSchedule {
+    id              Int          @id @default(autoincrement())
+    class           TechingClass
+    startDate       DateTime?
+    endDate         DateTime?
+    repeatsEvery    Int?
+    repetition      String       @default("week")
+    startTime       String
+    durationMinutes Int
+}
+
+model Lesson {
+    id         Int          @id @default(autoincrement())
+    class      TechingClass @relation(fields: [classId], references: [id])
+    classId    Int
+    title      String
+    date       DateTime
+    descrition String?
+    topics     Topic[]
+}
+
+model StudyPlan {
+    id      Int     @id @default(autoincrement())
+    class   Class   @relation(fields: [classId], references: [id])
+    classId Int
+    topics  Topic[]
+}
+
+model Topic {
+    id          Int        @id @default(autoincrement())
+    title       String
+    description String
+    studyPlan   StudyPlan? @relation(fields: [studyPlanId], references: [id])
+    studyPlanId Int?
+    lesson      Lesson?    @relation(fields: [lessonId], references: [id])
+    lessonId    Int?
+}
```


