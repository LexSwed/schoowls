# Migration `20200801125642`

This migration has been generated by Alexander Swed at 8/1/2020, 3:56:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "Timetable" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT)

ALTER TABLE "Period" ADD COLUMN "timetableId" INTEGER ;

CREATE TABLE "new_Teacher" (
"userId" INTEGER NOT NULL,
PRIMARY KEY ("userId"),
FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

INSERT INTO "new_Teacher" ("userId") SELECT "userId" FROM "Teacher"

PRAGMA foreign_keys=off;
DROP TABLE "Teacher";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Teacher" RENAME TO "Teacher";

CREATE UNIQUE INDEX "Teacher_userId" ON "Teacher"("userId")

CREATE TABLE "new_User" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"email" TEXT NOT NULL,
"name" TEXT NOT NULL,
"phoneNumber" TEXT ,
"avatarUrl" TEXT ,
"timeZone" TEXT ,
"disabled" BOOLEAN  DEFAULT false,
"registeredAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP,
"lastLoginAt" DATE ,
"lastActivityAt" DATE )

INSERT INTO "new_User" ("avatarUrl", "disabled", "email", "id", "lastActivityAt", "lastLoginAt", "name", "phoneNumber", "registeredAt", "timeZone") SELECT "avatarUrl", "disabled", "email", "id", "lastActivityAt", "lastLoginAt", "name", "phoneNumber", "registeredAt", "timeZone" FROM "User"

PRAGMA foreign_keys=off;
DROP TABLE "User";;
PRAGMA foreign_keys=on

ALTER TABLE "new_User" RENAME TO "User";

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE TABLE "new_Course" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"name" TEXT NOT NULL,
"grade" INTEGER )

INSERT INTO "new_Course" ("grade", "id", "name") SELECT "grade", "id", "name" FROM "Course"

PRAGMA foreign_keys=off;
DROP TABLE "Course";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Course" RENAME TO "Course";

CREATE UNIQUE INDEX "Course.name_unique" ON "Course"("name")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200722210934..20200801125642
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
     provider = "sqlite"
-    url = "***"
+    url = "***"
 }
 generator client {
     provider = "prisma-client-js"
@@ -46,8 +46,13 @@
     grade         Int?
     techingCourse TechingCourse[]
 }
+model Timetable {
+    id      Int      @id @default(autoincrement())
+    periods Period[]
+}
+
 model TechingCourseSchedule {
     id        Int           @id @default(autoincrement())
     class     TechingCourse
     /// beginning of the course
@@ -92,5 +97,7 @@
     startTime             String
     /// Minutes
     duration              Int
     techingCourseSchedule TechingCourseSchedule[]
+    timetable             Timetable?              @relation(fields: [timetableId], references: [id])
+    timetableId           Int?
 }
```


