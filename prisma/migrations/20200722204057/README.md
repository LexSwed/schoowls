# Migration `20200722204057`

This migration has been generated by Alexander Swed at 7/22/2020, 8:40:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

DROP INDEX "StudyPlan_classId"

CREATE TABLE "TechingCourse" (
"color" TEXT NOT NULL,
"courseId" INTEGER NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"scheduleId" INTEGER NOT NULL,
"teacherId" INTEGER NOT NULL,FOREIGN KEY ("courseId") REFERENCES "Course"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("teacherId") REFERENCES "Teacher"("userId") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("scheduleId") REFERENCES "TechingCourseSchedule"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Course" (
"grade" INTEGER ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"name" TEXT NOT NULL)

CREATE TABLE "TechingCourseSchedule" (
"day" INTEGER NOT NULL,
"endDate" DATE ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"periodId" INTEGER NOT NULL,
"startDate" DATE ,FOREIGN KEY ("periodId") REFERENCES "Period"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "Period" (
"duration" INTEGER NOT NULL,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"startTime" TEXT NOT NULL)

CREATE TABLE "new_Lesson" (
"descrition" TEXT ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"techingCourseId" INTEGER ,
"title" TEXT NOT NULL,FOREIGN KEY ("techingCourseId") REFERENCES "TechingCourse"("id") ON DELETE SET NULL ON UPDATE CASCADE)

INSERT INTO "new_Lesson" ("descrition", "id", "title") SELECT "descrition", "id", "title" FROM "Lesson"

PRAGMA foreign_keys=off;
DROP TABLE "Lesson";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Lesson" RENAME TO "Lesson";

CREATE TABLE "new_StudyPlan" (
"grade" INTEGER ,
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT)

INSERT INTO "new_StudyPlan" ("id") SELECT "id" FROM "StudyPlan"

PRAGMA foreign_keys=off;
DROP TABLE "StudyPlan";;
PRAGMA foreign_keys=on

ALTER TABLE "new_StudyPlan" RENAME TO "StudyPlan";

ALTER TABLE "Topic" ADD COLUMN "courseId" INTEGER ;

CREATE UNIQUE INDEX "TechingCourse_scheduleId" ON "TechingCourse"("scheduleId")

CREATE UNIQUE INDEX "Course.name" ON "Course"("name")

PRAGMA foreign_keys=off;
DROP TABLE "TechingClass";;
PRAGMA foreign_keys=on

PRAGMA foreign_keys=off;
DROP TABLE "Class";;
PRAGMA foreign_keys=on

PRAGMA foreign_keys=off;
DROP TABLE "TechingClassSchedule";;
PRAGMA foreign_keys=on

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200719111918-init..20200722204057
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
     provider = "sqlite"
-    url = "***"
+    url = "***"
 }
 generator client {
     provider = "prisma-client-js"
@@ -21,58 +21,58 @@
     teacher        Teacher?
 }
 model Teacher {
-    userId  Int            @id
-    user    User           @relation(fields: [userId], references: [id])
-    classes TechingClass[]
+    userId  Int             @id
+    user    User            @relation(fields: [userId], references: [id])
+    classes TechingCourse[]
 }
-model TechingClass {
-    id         Int                  @id @default(autoincrement())
-    class      Class                @relation(fields: [classId], references: [id])
-    classId    Int
-    teacher    Teacher              @relation(fields: [teacherId], references: [userId])
+model TechingCourse {
+    id         Int                   @id @default(autoincrement())
+    course     Course                @relation(fields: [courseId], references: [id])
+    courseId   Int
+    teacher    Teacher               @relation(fields: [teacherId], references: [userId])
     teacherId  Int
-    schedule   TechingClassSchedule @relation(fields: [scheduleId], references: [id])
+    schedule   TechingCourseSchedule @relation(fields: [scheduleId], references: [id])
     scheduleId Int
     color      String
     lessons    Lesson[]
 }
-model Class {
-    id             Int            @id @default(autoincrement())
-    name           String         @unique
-    techingClasses TechingClass[]
-    plan           StudyPlan
+model Course {
+    id            Int             @id @default(autoincrement())
+    name          String          @unique
+    topics        Topic[]
+    grade         Int?
+    techingCourse TechingCourse[]
 }
-model TechingClassSchedule {
-    id              Int          @id @default(autoincrement())
-    class           TechingClass
-    startDate       DateTime?
-    endDate         DateTime?
-    repeatsEvery    Int?
-    repetition      String       @default("week")
-    startTime       String
-    durationMinutes Int
+model TechingCourseSchedule {
+    id        Int           @id @default(autoincrement())
+    class     TechingCourse
+    /// beginning of the course
+    startDate DateTime?
+    /// end of the course
+    endDate   DateTime?
+    day       Int
+    period    Period        @relation(fields: [periodId], references: [id])
+    periodId  Int
 }
 model Lesson {
-    id         Int          @id @default(autoincrement())
-    class      TechingClass @relation(fields: [classId], references: [id])
-    classId    Int
-    title      String
-    date       DateTime
-    descrition String?
-    topics     Topic[]
+    id              Int            @id @default(autoincrement())
+    title           String
+    descrition      String?
+    topics          Topic[]
+    techingCourse   TechingCourse? @relation(fields: [techingCourseId], references: [id])
+    techingCourseId Int?
 }
 model StudyPlan {
-    id      Int     @id @default(autoincrement())
-    class   Class   @relation(fields: [classId], references: [id])
-    classId Int
-    topics  Topic[]
+    id    Int     @id @default(autoincrement())
+    grade Int?
+    topic Topic[]
 }
 model Topic {
     id          Int        @id @default(autoincrement())
@@ -81,5 +81,16 @@
     studyPlan   StudyPlan? @relation(fields: [studyPlanId], references: [id])
     studyPlanId Int?
     lesson      Lesson?    @relation(fields: [lessonId], references: [id])
     lessonId    Int?
+    course      Course?    @relation(fields: [courseId], references: [id])
+    courseId    Int?
 }
+
+model Period {
+    id                    Int                     @id @default(autoincrement())
+    /// hh:mm
+    startTime             String
+    /// Minutes
+    duration              Int
+    techingCourseSchedule TechingCourseSchedule[]
+}
```


