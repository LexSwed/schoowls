# Migration `20200814092337`

This migration has been generated by Alexander Swed at 8/14/2020, 11:23:37 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "User" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"email" TEXT NOT NULL,
"name" TEXT NOT NULL,
"phoneNumber" TEXT ,
"avatarUrl" TEXT ,
"timeZone" TEXT ,
"disabled" BOOLEAN  DEFAULT false,
"registeredAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
"lastLoginAt" DATETIME ,
"lastActivityAt" DATETIME )

CREATE TABLE "Teacher" (
"userId" INTEGER NOT NULL,
PRIMARY KEY ("userId"),
FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "TechingCourse" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"courseId" INTEGER NOT NULL,
"teacherId" INTEGER NOT NULL,
"scheduleId" INTEGER NOT NULL,
"color" TEXT NOT NULL,
FOREIGN KEY ("courseId") REFERENCES "Course"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("teacherId") REFERENCES "Teacher"("userId") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("scheduleId") REFERENCES "TechingCourseSchedule"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Course" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"name" TEXT NOT NULL,
"grade" INTEGER )

CREATE TABLE "Timetable" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"teacherId" INTEGER NOT NULL,
FOREIGN KEY ("teacherId") REFERENCES "Teacher"("userId") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "TechingCourseSchedule" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"startDate" DATETIME ,
"endDate" DATETIME ,
"day" INTEGER ,
"periodId" INTEGER ,
FOREIGN KEY ("periodId") REFERENCES "Period"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "Lesson" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"title" TEXT NOT NULL,
"descrition" TEXT ,
"techingCourseId" INTEGER ,
FOREIGN KEY ("techingCourseId") REFERENCES "TechingCourse"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "StudyPlan" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"grade" INTEGER )

CREATE TABLE "Topic" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"title" TEXT NOT NULL,
"description" TEXT NOT NULL,
"studyPlanId" INTEGER ,
"lessonId" INTEGER ,
"courseId" INTEGER ,
FOREIGN KEY ("studyPlanId") REFERENCES "StudyPlan"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("lessonId") REFERENCES "Lesson"("id") ON DELETE SET NULL ON UPDATE CASCADE,

FOREIGN KEY ("courseId") REFERENCES "Course"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "Period" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"startTime" TEXT NOT NULL,
"duration" INTEGER NOT NULL,
"timetableId" INTEGER ,
FOREIGN KEY ("timetableId") REFERENCES "Timetable"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Teacher_userId" ON "Teacher"("userId")

CREATE UNIQUE INDEX "TechingCourse_scheduleId" ON "TechingCourse"("scheduleId")

CREATE UNIQUE INDEX "Course.name_unique" ON "Course"("name")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200814092337
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,106 @@
+datasource db {
+    provider = "sqlite"
+    url = "***"
+}
+
+generator client {
+    provider = "prisma-client-js"
+}
+
+model User {
+    id             Int       @id @default(autoincrement())
+    email          String    @unique
+    name           String
+    phoneNumber    String?
+    avatarUrl      String?
+    timeZone       String?
+    disabled       Boolean?  @default(false)
+    registeredAt   DateTime  @default(now()) // ISO Date
+    lastLoginAt    DateTime? // ISO Date
+    lastActivityAt DateTime? // ISO Date
+    teacher        Teacher?
+}
+
+model Teacher {
+    userId     Int             @id
+    user       User            @relation(fields: [userId], references: [id])
+    classes    TechingCourse[]
+    timetables Timetable[]
+}
+
+model TechingCourse {
+    id         Int                   @id @default(autoincrement())
+    course     Course                @relation(fields: [courseId], references: [id])
+    courseId   Int
+    teacher    Teacher               @relation(fields: [teacherId], references: [userId])
+    teacherId  Int
+    schedule   TechingCourseSchedule @relation(fields: [scheduleId], references: [id])
+    scheduleId Int
+    color      String
+    lessons    Lesson[]
+}
+
+model Course {
+    id            Int             @id @default(autoincrement())
+    name          String          @unique
+    topics        Topic[]
+    grade         Int?
+    techingCourse TechingCourse[]
+}
+
+model Timetable {
+    id        Int      @id @default(autoincrement())
+    periods   Period[]
+    creator   Teacher  @relation(fields: [teacherId], references: [userId])
+    teacherId Int
+}
+
+model TechingCourseSchedule {
+    id        Int           @id @default(autoincrement())
+    class     TechingCourse
+    /// beginning of the course
+    startDate DateTime?
+    /// end of the course
+    endDate   DateTime?
+    day       Int?
+    period    Period?       @relation(fields: [periodId], references: [id])
+    periodId  Int?
+}
+
+model Lesson {
+    id              Int            @id @default(autoincrement())
+    title           String
+    descrition      String?
+    topics          Topic[]
+    techingCourse   TechingCourse? @relation(fields: [techingCourseId], references: [id])
+    techingCourseId Int?
+}
+
+model StudyPlan {
+    id    Int     @id @default(autoincrement())
+    grade Int?
+    topic Topic[]
+}
+
+model Topic {
+    id          Int        @id @default(autoincrement())
+    title       String
+    description String
+    studyPlan   StudyPlan? @relation(fields: [studyPlanId], references: [id])
+    studyPlanId Int?
+    lesson      Lesson?    @relation(fields: [lessonId], references: [id])
+    lessonId    Int?
+    course      Course?    @relation(fields: [courseId], references: [id])
+    courseId    Int?
+}
+
+model Period {
+    id                    Int                     @id @default(autoincrement())
+    /// hh:mm
+    startTime             String
+    /// Minutes
+    duration              Int
+    techingCourseSchedule TechingCourseSchedule[]
+    timetable             Timetable?              @relation(fields: [timetableId], references: [id])
+    timetableId           Int?
+}
```


